var Match,calculate_operations,consecutive_where,create_index,diff,find_match,find_matching_blocks,html_to_tokens,is_end_of_tag,is_start_of_tag,is_tag,is_whitespace,isnt_tag,op_map,recursively_find_matching_blocks,render_operations,wrap;is_end_of_tag=function(a){return">"===a};is_start_of_tag=function(a){return"<"===a};is_whitespace=function(a){return/^\s+$/.test(a)};is_tag=function(a){return/^\s*<[^>]+>\s*$/.test(a)};isnt_tag=function(a){return!is_tag(a)};
var Input_0$classdecl$var0=function(a,c,e){this.start_in_before=a;this.start_in_after=c;this.length=e;this.end_in_before=this.start_in_before+this.length-1;this.end_in_after=this.start_in_after+this.length-1};Match=Input_0$classdecl$var0;
html_to_tokens=function(a){var c;var e="char";var b="";var d=[];var g=0;for(c=a.length;g<c;g++){var f=a[g];switch(e){case "tag":is_end_of_tag(f)?(b+=">",d.push(b),b="",e=is_whitespace(f)?"whitespace":"char"):b+=f;break;case "char":is_start_of_tag(f)?(b&&d.push(b),b="<",e="tag"):/\s/.test(f)?(b&&d.push(b),b=f,e="whitespace"):/[\w#@]+/i.test(f)?b+=f:(b&&d.push(b),b=f);break;case "whitespace":is_start_of_tag(f)?(b&&d.push(b),b="<",e="tag"):is_whitespace(f)?b+=f:(b&&d.push(b),b=f,e="char");break;default:throw Error("Unknown mode ${mode}");
}}b&&d.push(b);return d};find_match=function(a,c,e,b,d,g,f){var l,h,k,q;var m=b;c=g;var r=0;var t={};for(h=l=b;b<=d?l<d:l>d;h=b<=d?++l:--l){var v={};var n=a[h];var w=e[n];var u=0;for(k=w.length;u<k;u++)if(n=w[u],!(n<g)){if(n>=f)break;null==t[n-1]&&(t[n-1]=0);var p=t[n-1]+1;v[n]=p;p>r&&(m=h-p+1,c=n-p+1,r=p)}t=v}0!==r&&(q=new Match(m,c,r));return q};
recursively_find_matching_blocks=function(a,c,e,b,d,g,f,l){var h=find_match(a,c,e,b,d,g,f);null!=h&&(b<h.start_in_before&&g<h.start_in_after&&recursively_find_matching_blocks(a,c,e,b,h.start_in_before,g,h.start_in_after,l),l.push(h),h.end_in_before<=d&&h.end_in_after<=f&&recursively_find_matching_blocks(a,c,e,h.end_in_before+1,d,h.end_in_after+1,f,l));return l};
create_index=function(a){var c,e;if(null==a.find_these)throw Error("params must have find_these key");if(null==a.in_these)throw Error("params must have in_these key");var b={};var d=a.find_these;var g=0;for(e=d.length;g<e;g++){var f=d[g];b[f]=[];for(c=a.in_these.indexOf(f);-1!==c;)b[f].push(c),c=a.in_these.indexOf(f,c+1)}return b};find_matching_blocks=function(a,c){var e=create_index({find_these:a,in_these:c});return recursively_find_matching_blocks(a,c,e,0,a.length,0,c.length,[])};
calculate_operations=function(a,c){var e,b,d;if(null==a)throw Error("before_tokens?");if(null==c)throw Error("after_tokens?");var g=d=0;var f=[];var l={"false,false":"replace","true,false":"insert","false,true":"delete","true,true":"none"};var h=find_matching_blocks(a,c);h.push(new Match(a.length,c.length,0));var k=e=0;for(b=h.length;e<b;k=++e){k=h[k];var q=g===k.start_in_before;var m=d===k.start_in_after;m=l[[q,m].toString()];"none"!==m&&f.push({action:m,start_in_before:g,end_in_before:"insert"!==
m?k.start_in_before-1:void 0,start_in_after:d,end_in_after:"delete"!==m?k.start_in_after-1:void 0});0!==k.length&&f.push({action:"equal",start_in_before:k.start_in_before,end_in_before:k.end_in_before,start_in_after:k.start_in_after,end_in_after:k.end_in_after});g=k.end_in_before+1;d=k.end_in_after+1}g=[];b={action:"none"};l=function(b){return"equal"!==b.action||0!==b.end_in_before-b.start_in_before?!1:/^\s$/.test(a.slice(b.start_in_before,+b.end_in_before+1||9E9))};e=0;for(h=f.length;e<h;e++)d=f[e],
l(d)&&"replace"===b.action||"replace"===d.action&&"replace"===b.action?(b.end_in_before=d.end_in_before,b.end_in_after=d.end_in_after):(g.push(d),b=d);return g};consecutive_where=function(a,c,e){var b;c=c.slice(a,+c.length+1||9E9);var d=void 0;var g=a=0;for(b=c.length;a<b;g=++a){var f=c[g];f=e(f);!0===f&&(d=g);if(!1===f)break}return null!=d?c.slice(0,+d+1||9E9):[]};
wrap=function(a,c){var e;var b="";var d=0;for(e=c.length;!(d>=e);){var g=consecutive_where(d,c,isnt_tag);d+=g.length;0!==g.length&&(b+="<"+a+">"+g.join("")+"</"+a+">");if(d>=e)break;g=consecutive_where(d,c,is_tag);d+=g.length;b+=g.join("")}return b};
op_map={equal:function(a,c,e){return c.slice(a.start_in_before,+a.end_in_before+1||9E9).join("")},insert:function(a,c,e){a=e.slice(a.start_in_after,+a.end_in_after+1||9E9);return wrap("ins",a)},"delete":function(a,c,e){a=c.slice(a.start_in_before,+a.end_in_before+1||9E9);return wrap("del",a)},replace:function(a,c,e){return op_map["delete"](a,c,e)+op_map.insert(a,c,e)}};render_operations=function(a,c,e){var b;var d="";var g=0;for(b=e.length;g<b;g++){var f=e[g];d+=op_map[f.action](f,a,c)}return d};
diff=function(a,c){if(a===c)return a;a=html_to_tokens(a);c=html_to_tokens(c);var e=calculate_operations(a,c);return render_operations(a,c,e)};diff.html_to_tokens=html_to_tokens;diff.find_matching_blocks=find_matching_blocks;find_matching_blocks.find_match=find_match;find_matching_blocks.create_index=create_index;diff.calculate_operations=calculate_operations;diff.render_operations=render_operations;
"function"===typeof define?define([],function(){return diff}):"undefined"!==typeof module&&null!==module?module.exports=diff:this.htmldiff=diff;